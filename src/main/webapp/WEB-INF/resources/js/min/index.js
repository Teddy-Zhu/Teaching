function unix2human(e){var n=new Date(e),t=n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate()+" "+p(n.getHours())+":"+p(n.getMinutes())+":"+p(n.getSeconds());return t}function p(e){return 10>e?"0"+e:e}function delShakeClass(e){$("#"+e).parent().removeClass("animated shake")}function returntimeer(e){return function(){delShakeClass(e)}}function account(){new PNotify({title:"消息",text:"测试账号!<br>Admin==>Admin;a<br>BookManager==>Troevil;123456<br>Teacher==>TestUser;TestUser<br>Student==>AAAA;AAAAAAAA.<br>点击版本号查看版本细节!",type:"success",animation:"slide"})}function backgroundToggle(e){e?$("body").css("cssText","background-image:url(https://unsplash.it/"+$(this).width()+"/"+$(this).height()+"?random) ; background-repeat: no-repeat; background-attachment: fixed; background-position: center 0; background-size: cover;"):$("body").css("cssText","background-color:#353535 ! important")}function authUserRepeat(){var e=$("#UserName").val();""!=e&&""!=e.trim()&&$.ajax({url:"User/AuthUserName",type:"post",data:{UserName:e},dataType:"json",complete:function(e){},success:function(e){null!=e&&e?hander.action.SetSucccess("UserName"):hander.action.SetFailed("UserName")},error:function(e){console.debug(e.status)},async:!0})}function selectchange(){var e=function(e){$("#Majors").empty();for(var n=0,t=e.length;t>n;n++)$("#Majors").append('<option value="'+e[n].intid+'">'+e[n].strname+"</option>")};void 0==$("#registerModal").data("department"+$("#DepartMent").val())?$.ajax({url:"Type/GetDepartMent",type:"post",dataType:"json",data:{id:$("#DepartMent").val()},complete:function(e){},success:function(n){null!=n?null!=n&&($("#registerModal").data("department"+$("#DepartMent").val(),n),e(n)):$.TeachDialog({content:"获取专业信息失败!"})},async:!0}):e($("#registerModal").data("department"+$("#DepartMent").val()))}var error='<div class="alert alert-danger" role="alert" style="display:none;line-height: 0px;width: 80%;height: 1px;">{errormsg}</div>',hander={action:{SetFailed:function(e){var n=$("#"+e).parent();n.removeClass("has-success").removeClass("has-error").addClass("has-error").addClass("animated-fast shake").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("animated-fast shake")})},SetSucccess:function(e){var n=$("#"+e).parent();n.removeClass("has-success").removeClass("has-error").addClass("has-success")}}};$(function(){$("#loginModal").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("animated fadeInDown")}),$.getScript("resources/plugins/pnotify/pnotify.custom.min.js",function(){account()}),NProgress.configure({ease:"ease",speed:1e3}),$(document).ajaxStart(function(){NProgress.start()}),$(document).ajaxStop(function(){NProgress.done()}),$("a.UserAccount").click(function(){account()}),$("#toggleBackGround").bootstrapSwitch("size","mini"),$("#toggleBackGround").bootstrapSwitch("onSwitchChange",function(e,n){backgroundToggle(n)}),$("a.version").click(function(){$.TeachDialog({title:"版本",content:'<strong>版本号说明:第一位:Web版本号,第二位:功能版本号,第三位:BugFix版本号!</strong><div id="versioninfo" style="margin-top:10px;"></div>'}),$.ajax({url:"action/GetVersions",type:"post",dataType:"json",data:{page:1,rows:5},success:function(e){for(var n=0;n<e.length;n++)$("#versioninfo").append('<div class="panel panel-default" style="margin-top:3px;margin-bottom:0px;"><div class="panel-heading">版本号:'+e[n].strversion+"."+e[n].strfunversion+"."+e[n].strbuildversion+'<div style="float:right">'+unix2human(e[n].dateupdatetime)+'</div></div><div class="panel-body">'+e[n].strupdatecomment+"</div></div>")},error:function(e){},async:!0})}),$("#loginButton").click(function(){var e,n,t;return $(this).button("loading"),$(".preloader").fadeToggle("slow"),e=$("#loginUserName").val(),n=!0,""==e||""==e.trim()?(hander.action.SetFailed("loginUserName"),n=!1):hander.action.SetSucccess("loginUserName"),t=$("#loginPassWord").val(),""==t||""==t.trim()?(hander.action.SetFailed("loginPassWord"),n=!1):hander.action.SetSucccess("loginPassWord"),n?($.ajax({url:"User/AuthLogin",type:"post",data:{UserName:e,PassWord:t},dataType:"json",complete:function(e){},success:function(e){return e?void $.TeachDialog({content:"登陆成功，欢迎使用本系统!",dialogHidden:function(){var e="AdminMenu";-1!=window.location.href.indexOf("ref=")&&(e=window.location.href.replace(/(.*?)ref=\//,"")),window.location.href=e}}):void $.TeachDialog({content:"登录失败，请检查你的用户名和密码是否匹配!"})},error:function(e){console.debug(e.status),$.TeachDialog(3388==e.status?{content:"登录失败，用户被禁用.",bootstrapModalOption:{},dialogHidden:function(){$(".preloader").fadeToggle("slow")}}:{content:"登录失败，服务端故障.",bootstrapModalOption:{},dialogHidden:function(){$(".preloader").fadeToggle("slow")}})},async:!0}),void $(this).button("reset")):($(this).button("reset"),void $(".preloader").fadeToggle("slow"))}),$("#DepartMent").change(function(){selectchange()}),$(".glyphicon.glyphicon-chevron-down").click(function(){var e,n;"block"==$("#loginModal")[0].style.display?(e=function(e){var n,t,a;for($("#UserType").empty(),n=0,t=e.length;t>n;n++)a='<option value="'+e[n].intidentityid+'">'+e[n].strname+"</option>",$("#UserType").append(a)},void 0!=$("#registerModal").data("usertype")?e($("#registerModal").data("usertype")):$.ajax({url:"Type/GetUserType",type:"post",dataType:"json",complete:function(e){},success:function(n){null!=n?($("#registerModal").data("usertype",n),e(n)):$.TeachDialog({content:"获取用户类型失败!"})},async:!0}),n=function(e){$("#DepartMent").empty();for(var n=0,t=e.length;t>n;n++)$("#DepartMent").append('<option value="'+e[n].intid+'">'+e[n].strname+"</option>");selectchange()},void 0==$("#registerModal").data("department1")?$.ajax({url:"Type/GetDepartMent",type:"post",dataType:"json",data:{id:1},complete:function(e){},success:function(e){null!=e?($("#registerModal").data("department1",e),n(e)):$.TeachDialog({content:"获取系部信息失败!"})},error:function(e){console.debug(e.status)},async:!0}):n($("#registerModal").data("department1")),$("#loginModal").addClass("animated-fast fadeOutDown").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("animated-fast fadeOutDown").hide(),$("#registerModal").show().addClass("animated-fast fadeInDown").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("animated-fast fadeInDown")})})):$("#registerModal").addClass("animated-fast fadeOutDown").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("animated-fast fadeOutDown").hide(),$("#loginModal").show().addClass("animated-fast fadeInDown").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("animated-fast fadeInDown")})})}),$(".passwordc.input-group-addon.glyphicon").click(function(){var e=$(this).hasClass("glyphicon-eye-open"),n="text";e&&(n="password"),$(this).prev().attr("type",n),e?($(this).removeClass("glyphicon-eye-open"),$(this).addClass("glyphicon-eye-close")):($(this).removeClass("glyphicon-eye-close"),$(this).addClass("glyphicon-eye-open"))}),$("#registerButton").click(function(){var e,n;return $(".alert.alert-danger").slideDown(),$(".alert.alert-danger").remove(),$(".preloader").fadeToggle("slow"),$(this).button("loading"),e=new Object,n=!0,$(".RegisterForm").each(function(){var t=$(this).val(),a=$(this).attr("id");null==t&&void 0==t?(hander.action.SetFailed(a),n=!1):(t=t.trim(),""!=t?(e[a]=t,hander.action.SetSucccess(a)):(n=!1,hander.action.SetFailed(a))),"RePassWord"==a&&t!=$("#Password").val()&&(n=!1,hander.action.SetFailed(a))}),n?void $.ajax({url:"User/AuthRegister",type:"post",data:e,dataType:"json",success:function(e){null!=e&&e?$.TeachDialog({content:"注册成功!",dialogHidden:function(){window.location.href="/"}}):($.TeachDialog({content:"注册失败!"}),$(this).button("reset"),$(".preloader").fadeToggle("slow"))},error:function(e){$.TeachDialog({content:"注册失败，服务端错误.",bootstrapModalOption:{}}),console.debug(e.status)},async:!0}):($(".alert.alert-danger").slideDown(),$(this).button("reset"),void $(".preloader").fadeToggle("slow"))}),$("#resetButton").click(function(){$("#loginPassWord").val(""),$("#loginUserName").val("")}),$("#loginPassWord").keypress(function(e){13==e.which&&$("#loginButton").trigger("click")}),$("#UserName").blur(function(){authUserRepeat()})});