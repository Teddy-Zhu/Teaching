function unix2human(unixtime){var dateObj=new Date(unixtime),UnixTimeToDate=dateObj.getFullYear()+"-"+(dateObj.getMonth()+1)+"-"+dateObj.getDate()+" "+p(dateObj.getHours())+":"+p(dateObj.getMinutes())+":"+p(dateObj.getSeconds());return UnixTimeToDate}function p(s){return 10>s?"0"+s:s}function delShakeClass(domId){$("#"+domId).parent().removeClass("animated shake")}function returntimeer(domId){return function(){delShakeClass(domId)}}function account(){new PNotify({title:"Message",text:"测试账号!<br>Admin==>Admin;a<br>BookManager==>Troevil;123456<br>Teacher==>TestUser;TestUser<br>Student==>AAAA;AAAAAAAA.<br>点击版本号查看版本细节!",type:"success",animation:"slide"})}function backgroundToggle(flag){flag?$("body").css("cssText","background-image:url(https://unsplash.it/"+$(this).width()+"/"+$(this).height()+"?random) ; background-repeat: no-repeat; background-attachment: fixed; background-position: center 0; background-size: cover;"):$("body").css("cssText","background-color:#353535 ! important")}function authUserRepeat(){var userName=$("#UserName").val();""!=userName&&""!=userName.trim()&&$.ajax({url:"User/AuthUserName",type:"post",data:{UserName:userName},dataType:"json",complete:function(data){},success:function(data){null!=data&&data?hander.action.SetSucccess("UserName"):hander.action.SetFailed("UserName")},error:function(data){console.debug(data.status)},async:!0})}function selectchange(){var fillDom=function(domData){$("#Majors").empty();for(var i=0,len=domData.length;len>i;i++)$("#Majors").append('<option value="'+domData[i].intid+'">'+domData[i].strname+"</option>")};void 0==$("#registerModal").data("department"+$("#DepartMent").val())?$.ajax({url:"Type/GetDepartMent",type:"post",dataType:"json",data:{id:$("#DepartMent").val()},complete:function(data){},success:function(data){null!=data?null!=data&&($("#registerModal").data("department"+$("#DepartMent").val(),data),fillDom(data)):$.TeachDialog({title:"Faild",content:"Failed to achieve Majors!"})},async:!0}):fillDom($("#registerModal").data("department"+$("#DepartMent").val()))}var error='<div class="alert alert-danger" role="alert" style="display:none;line-height: 0px;width: 80%;height: 1px;">{errormsg}</div>',hander={action:{SetFailed:function(domId){var Opdom=$("#"+domId).parent();Opdom.removeClass("has-success").removeClass("has-error").addClass("has-error").addClass("animated-fast shake").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("animated-fast shake")})},SetSucccess:function(domId){var Opdom=$("#"+domId).parent();Opdom.removeClass("has-success").removeClass("has-error").addClass("has-success")}}};$(function(){$("#loginModal").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("animated fadeInDown")}),$.getScript("resources/plugins/pnotify/pnotify.custom.min.js",function(){account()}),NProgress.configure({ease:"ease",speed:1e3}),$(document).ajaxStart(function(){NProgress.start()}),$(document).ajaxStop(function(){NProgress.done()}),$("a.UserAccount").click(function(){account()}),$("#toggleBackGround").bootstrapSwitch("size","mini"),$("#toggleBackGround").bootstrapSwitch("onSwitchChange",function(e,data){backgroundToggle(data)}),$("a.version").click(function(){$.TeachDialog({title:"Versions",content:'<strong>版本号说明:第一位:Web版本号,第二位:功能版本号,第三位:BugFix版本号!</strong><div id="versioninfo" style="margin-top:10px;"></div>'}),$.ajax({url:"action/GetVersions",type:"post",dataType:"json",data:{page:1,rows:5},success:function(data){for(var i=0;i<data.length;i++)$("#versioninfo").append('<div class="panel panel-default" style="margin-top:3px;margin-bottom:0px;"><div class="panel-heading">版本号:'+data[i].strversion+"."+data[i].strfunversion+"."+data[i].strbuildversion+'<div style="float:right">'+unix2human(data[i].dateupdatetime)+'</div></div><div class="panel-body">'+data[i].strupdatecomment+"</div></div>")},error:function(data){},async:!0})}),$("#loginButton").click(function(){var userName,mark,passWord;return $(this).button("loading"),$(".preloader").fadeToggle("slow"),userName=$("#loginUserName").val(),mark=!0,""==userName||""==userName.trim()?(hander.action.SetFailed("loginUserName"),mark=!1):hander.action.SetSucccess("loginUserName"),passWord=$("#loginPassWord").val(),""==passWord||""==passWord.trim()?(hander.action.SetFailed("loginPassWord"),mark=!1):hander.action.SetSucccess("loginPassWord"),mark?($.ajax({url:"User/AuthLogin",type:"post",data:{UserName:userName,PassWord:passWord},dataType:"json",complete:function(data){},success:function(data){return data?void $.TeachDialog({title:"Congratulations",content:"Login Successfully! Welcome to Use the System!",dialogHidden:function(){var ref="AdminMenu";-1!=window.location.href.indexOf("ref=")&&(ref=window.location.href.replace(/(.*?)ref=\//,"")),window.location.href=ref}}):void $.TeachDialog({title:"Faild",content:"Failed to Login!Please ensure your password correct!"})},error:function(data){console.debug(data.status),$.TeachDialog(3388==data.status?{title:"Sorry!",content:"Login failed because the user is blocked.",bootstrapModalOption:{},dialogHidden:function(){$(".preloader").fadeToggle("slow")}}:{title:"Sorry!Service is down!",content:"Login failed because the service issue.",bootstrapModalOption:{},dialogHidden:function(){$(".preloader").fadeToggle("slow")}})},async:!0}),void $(this).button("reset")):($(this).button("reset"),void $(".preloader").fadeToggle("slow"))}),$("#DepartMent").change(function(){selectchange()}),$(".glyphicon.glyphicon-chevron-down").click(function(){var fillUserDom,fillDepartDom;"block"==$("#loginModal")[0].style.display?(fillUserDom=function(domData){var i,len,option;for($("#UserType").empty(),i=0,len=domData.length;len>i;i++)option='<option value="'+domData[i].intidentityid+'">'+domData[i].strname+"</option>",$("#UserType").append(option)},void 0!=$("#registerModal").data("usertype")?fillUserDom($("#registerModal").data("usertype")):$.ajax({url:"Type/GetUserType",type:"post",dataType:"json",complete:function(data){},success:function(data){null!=data?($("#registerModal").data("usertype",data),fillUserDom(data)):$.TeachDialog({title:"Faild",content:"Failed to achieve usertype!"})},async:!0}),fillDepartDom=function(domData){$("#DepartMent").empty();for(var i=0,len=domData.length;len>i;i++)$("#DepartMent").append('<option value="'+domData[i].intid+'">'+domData[i].strname+"</option>");selectchange()},void 0==$("#registerModal").data("department1")?$.ajax({url:"Type/GetDepartMent",type:"post",dataType:"json",data:{id:1},complete:function(data){},success:function(data){null!=data?($("#registerModal").data("department1",data),fillDepartDom(data)):$.TeachDialog({title:"Faild",content:"Failed to achieve department!"})},error:function(data){console.debug(data.status)},async:!0}):fillDepartDom($("#registerModal").data("department1")),$("#loginModal").addClass("animated-fast fadeOutDown").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("animated-fast fadeOutDown").hide(),$("#registerModal").show().addClass("animated-fast fadeInDown").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("animated-fast fadeInDown")})})):$("#registerModal").addClass("animated-fast fadeOutDown").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("animated-fast fadeOutDown").hide(),$("#loginModal").show().addClass("animated-fast fadeInDown").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("animated-fast fadeInDown")})})}),$(".passwordc.input-group-addon.glyphicon").click(function(){var ret=$(this).hasClass("glyphicon-eye-open"),str="text";ret&&(str="password"),$(this).prev().attr("type",str),ret?($(this).removeClass("glyphicon-eye-open"),$(this).addClass("glyphicon-eye-close")):($(this).removeClass("glyphicon-eye-close"),$(this).addClass("glyphicon-eye-open"))}),$("#registerButton").click(function(){var postdata,flag;return $(".alert.alert-danger").slideDown(),$(".alert.alert-danger").remove(),$(".preloader").fadeToggle("slow"),$(this).button("loading"),postdata=new Object,flag=!0,$(".RegisterForm").each(function(){var param=$(this).val(),id=$(this).attr("id");null==param&&void 0==param?(hander.action.SetFailed(id),flag=!1):(param=param.trim(),""!=param?(postdata[id]=param,hander.action.SetSucccess(id)):(flag=!1,hander.action.SetFailed(id))),"RePassWord"==id&&param!=$("#Password").val()&&(flag=!1,hander.action.SetFailed(id))}),flag?void $.ajax({url:"User/AuthRegister",type:"post",data:postdata,dataType:"json",success:function(data){null!=data&&data?$.TeachDialog({title:"Congratulations",content:"Register Successfully! Welcome to Use the System!",dialogHidden:function(){window.location.href="/"}}):($.TeachDialog({title:"Faild",content:"Failed to register!"}),$(this).button("reset"),$(".preloader").fadeToggle("slow"))},error:function(data){$.TeachDialog({title:"Sorry!Service is down!",content:"Login failed because the service issue.",bootstrapModalOption:{}}),console.debug(data.status)},async:!0}):($(".alert.alert-danger").slideDown(),$(this).button("reset"),void $(".preloader").fadeToggle("slow"))}),$("#resetButton").click(function(){$("#loginPassWord").val(""),$("#loginUserName").val("")}),$("#loginPassWord").keypress(function(e){13==e.which&&$("#loginButton").trigger("click")}),$("#UserName").blur(function(){authUserRepeat()})});