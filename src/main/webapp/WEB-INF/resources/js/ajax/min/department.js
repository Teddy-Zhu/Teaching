function treeonClick(event,treeId,treeNode,clickFlag){if(curtreeNode=treeNode,0==curtreeNode.intparentid)$("#parent_edit_sel").empty(),$("#parent_edit_sel").append('<option value="0">'+curtreeNode.strname+"</option>"),$("#parent_edit_sel").attr("disabled",!0),$("#parent_edit_name").attr("disabled",!0),$("#parent_insert_sel").val(curtreeNode.intid);else if(1==curtreeNode.intparentid)$("#parent_edit_sel").attr("disabled",!0),$("#parent_edit_name").attr("disabled",!1),$("#parent_edit_sel").empty(),$("#parent_edit_sel").append('<option value="1">System</option>'),$("#parent_insert_sel").val(curtreeNode.intid);else{$("#parent_edit_sel").attr("disabled",!1),$("#parent_edit_name").attr("disabled",!1);var dtd=$.Deferred();$.when(initUserDepartMent("parent_edit_sel",1,dtd)).done(function(){$("#parent_edit_sel").val(curtreeNode.intparentid)})}$("#parent_edit_name").val(curtreeNode.strname)}function loadDepartMent(){$.ajax({url:"DepartMent/GetAllDepartMent",type:"post",dataType:"json",success:function(response){nodes=$.fn.zTree.init($("#ul_tree"),setting,response);var treeObj=$.fn.zTree.getZTreeObj("ul_tree");treeObj.expandAll(!0),curtreeNode=null,$("#parent_edit_sel").removeData("department1",void 0)},async:!0})}function initial(){var dtd=$.Deferred();$.when(initUserDepartMent("parent_insert_sel",1,dtd)).done(function(){$("#parent_insert_sel").prepend('<option value="1">System</option>')}),loadDepartMent(),$("#parent_edit_sel").attr("disabled",!0),$("#parent_edit_name").attr("disabled",!0),$("#parent_edit_name").val("")}function initUserDepartMent(id,type,dtd){var fillDom=function(domData){$("#"+id).empty();for(var i=0;len=domData.length,i<len;i++)$("#"+id).append('<option value="'+domData[i].intid+'">'+domData[i].strname+"</option>");void 0!=dtd&&dtd.resolve()};return void 0!=$("#"+id).data("department"+type)?fillDom($("#"+id).data("department"+type)):$.ajax({url:"Type/GetDepartMent",type:"post",dataType:"json",data:{id:type},success:function(data){$("#"+id).data("department"+type,data),fillDom(data)},async:!0}),void 0!=dtd?dtd.promise():void 0}var nodes,curtreeNode,setting={data:{key:{name:"strname",url:""},simpleData:{enable:!0,idKey:"intid",pIdKey:"intparentid",rootPId:0},view:{showLine:!0,showIcon:!0}},callback:{onClick:treeonClick}};$(function(){initial(),$(".fa.fa-refresh").click(function(){initial()}),$("#insert").click(function(){var parentid=$("#parent_insert_sel").val(),name=$("#parent_insert_name").val().trim();return void 0==parentid||0==parentid||""==parentid||void 0==name||""==name?void $.TeachDialog({title:"Operation Message!",content:"Please input correct value!"}):void $.ajax({url:"DepartMent/Insert",type:"post",dataType:"json",data:{parentId:parentid,name:name},async:!0}).success(function(){initial(),$.TeachDialog({content:"Insert successfully!"})}).fail(function(){$.TeachDialog({content:"Update DepartMent Failed!"})})}),$("#edit").click(function(){var parentid,name;if(null==curtreeNode)return void $.TeachDialog({title:"Operation Message!",content:"Please select a node first."});if(0!=curtreeNode.intparentid)return parentid=$("#parent_edit_sel").val(),name=$("#parent_edit_name").val().trim(),void 0==parentid||0==parentid||""==parentid||void 0==name||""==name?void $.TeachDialog({title:"Operation Message!",content:"Please input correct value!"}):void $.ajax({url:"DepartMent/Update",type:"post",dataType:"json",data:{id:curtreeNode.intid,oldParentId:curtreeNode.intparentid,newParentId:parentid,name:name},async:!0}).success(function(){initial(),$.TeachDialog({title:"Operation Message!",content:"Update successfully!"})}).fail(function(){$.TeachDialog({title:"Operation Message!",content:"Update DepartMent Failed!"})})}),$("#delete").click(function(){return null==curtreeNode?void $.TeachDialog({title:"Operation Message!",content:"Please select a node first."}):void $.TeachDialog({title:"Warnning Message!",content:"Are you sure delete this node :"+curtreeNode.strname+" ?",showCloseButtonName:"No",otherButtons:["Yes"],clickButton:function(sender,modal,index){0==index&&$.ajax({url:"DepartMent/Delete",type:"post",dataType:"json",data:{id:curtreeNode.intid},async:!0}).success(function(response){response?(initial(),$.TeachDialog({title:"Operation Message!",content:"Delete successfully!"})):$.TeachDialog({title:"Operation Message!",content:"Delete DepartMent Failed!"})}).fail(function(){$.TeachDialog({title:"Operation Message!",content:"Delete DepartMent Failed!"})}),modal.modal("hide")}})})});