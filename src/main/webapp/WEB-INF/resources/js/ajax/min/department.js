function treeonClick(e,t,n,a){if(curtreeNode=n,0==curtreeNode.intparentid)$("#parent_edit_sel").empty(),$("#parent_edit_sel").append('<option value="0">'+curtreeNode.strname+"</option>"),$("#parent_edit_sel").attr("disabled",!0),$("#parent_edit_name").attr("disabled",!0),$("#parent_insert_sel").val(curtreeNode.intid);else if(1==curtreeNode.intparentid)$("#parent_edit_sel").attr("disabled",!0),$("#parent_edit_name").attr("disabled",!1),$("#parent_edit_sel").empty(),$("#parent_edit_sel").append('<option value="1">System</option>'),$("#parent_insert_sel").val(curtreeNode.intid);else{$("#parent_edit_sel").attr("disabled",!1),$("#parent_edit_name").attr("disabled",!1);var i=$.Deferred();$.when(initUserDepartMent("parent_edit_sel",1,i)).done(function(){$("#parent_edit_sel").val(curtreeNode.intparentid)})}$("#parent_edit_name").val(curtreeNode.strname)}function loadDepartMent(){$.ajax({url:"DepartMent/GetAllDepartMent",type:"post",dataType:"json",success:function(e){nodes=$.fn.zTree.init($("#ul_tree"),setting,e);var t=$.fn.zTree.getZTreeObj("ul_tree");t.expandAll(!0),curtreeNode=null,$("#parent_edit_sel").removeData("department1")},async:!0})}function initial(){var e=$.Deferred();$.when(initUserDepartMent("parent_insert_sel",1,e)).done(function(){$("#parent_insert_sel").prepend('<option value="1">System</option>')}),loadDepartMent(),$("#parent_edit_sel").attr("disabled",!0),$("#parent_edit_name").attr("disabled",!0),$("#parent_edit_name").val("")}function initUserDepartMent(e,t,n){var a=function(t){$("#"+e).empty();for(var a=0;len=t.length,a<len;a++)$("#"+e).append('<option value="'+t[a].intid+'">'+t[a].strname+"</option>");void 0!=n&&n.resolve()};return void 0!=$("#"+e).data("department"+t)?a($("#"+e).data("department"+t)):$.ajax({url:"Type/GetDepartMent",type:"post",dataType:"json",data:{id:t},success:function(n){$("#"+e).data("department"+t,n),a(n)},async:!0}),void 0!=n?n.promise():void 0}var nodes,curtreeNode,setting={data:{key:{name:"strname",url:""},simpleData:{enable:!0,idKey:"intid",pIdKey:"intparentid",rootPId:0},view:{showLine:!0,showIcon:!0}},callback:{onClick:treeonClick}};$(function(){initial(),$(".fa.fa-refresh").click(function(){initial()}),$("#insert").click(function(){var e=$("#parent_insert_sel").val(),t=$("#parent_insert_name").val().trim();return void 0==e||0==e||""==e||void 0==t||""==t?void $.TeachDialog({content:"请输入正确的值!"}):void $.ajax({url:"DepartMent/Insert",type:"post",dataType:"json",data:{parentId:e,name:t},async:!0}).success(function(){initial(),$.TeachDialog({content:"新增成功!"})}).fail(function(){$.TeachDialog({content:"更新失败!"})})}),$("#edit").click(function(){var e,t;if(null==curtreeNode)return void $.TeachDialog({content:"请至少选择一行."});if(0!=curtreeNode.intparentid)return e=$("#parent_edit_sel").val(),t=$("#parent_edit_name").val().trim(),void 0==e||0==e||""==e||void 0==t||""==t?void $.TeachDialog({content:"请输入正确的值!"}):void $.ajax({url:"DepartMent/Update",type:"post",dataType:"json",data:{id:curtreeNode.intid,oldParentId:curtreeNode.intparentid,newParentId:e,name:t},async:!0}).success(function(){initial(),$.TeachDialog({content:"更新成功!"})}).fail(function(){$.TeachDialog({content:"更新失败!"})})}),$("#delete").click(function(){return null==curtreeNode?void $.TeachDialog({content:"请至少选择一行."}):void $.TeachDialog({content:"你确定删除 :"+curtreeNode.strname+" ?",showCloseButtonName:"取消",otherButtons:["确认"],clickButton:function(e,t,n){0==n&&$.ajax({url:"DepartMent/Delete",type:"post",dataType:"json",data:{id:curtreeNode.intid},async:!0}).success(function(e){e?(initial(),$.TeachDialog({content:"删除成功!"})):$.TeachDialog({content:"删除失败!"})}).fail(function(){$.TeachDialog({content:"删除失败!"})}),t.modal("hide")}})})});