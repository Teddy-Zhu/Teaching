function LoadMenuTree(){$.ajax({url:"Menu/MenuTree",dataType:"json",type:"post"}).success(function(data){nodes=$.fn.zTree.init($("#ul_tree"),setting,data),treeObj=$.fn.zTree.getZTreeObj("ul_tree"),treeObj.expandAll(!0),curTreeNode=null})}function treeClick(event,treeId,treeNode,clickFlag){curTreeNode=treeNode,$("#menuname").val(treeNode.strmenuname),$("#menuicon").val(treeNode.strmenuiconclass)}var treeObj,curTreeNode,setting={data:{key:{name:"strmenuname"},simpleData:{enable:!0,idKey:"intmenuid",pIdKey:"intparentmenuid",rootPId:0},view:{showLine:!0,showIcon:!0}},callback:{onClick:treeClick}};$(function(){LoadMenuTree(),$("#refresh").click(function(){LoadMenuTree()}),$("#Update").click(function(){var menuname,icon;return null==curTreeNode?void $.TeachDialog({title:"Operation Message!",content:"Please select a menu to edit!"}):1==curTreeNode.intmenuid?void $.TeachDialog({title:"Operation Message!",content:"Can not edit the Root Menu!"}):(menuname=$("#menuname").val(),icon=$("#menuicon").val(),void $.ajax({url:"Menu/Update",type:"post",dataType:"json",data:{menu:curTreeNode.intmenuid,menuname:menuname,menuicon:icon},success:function(response){var html,menus;response?(curTreeNode.strmenuname=menuname,curTreeNode.strmenuiconclass=icon,curTreeNode.iconSkin=icon+" iconskin",treeObj.updateNode(curTreeNode),1==curTreeNode.intparentmenuid&&2!=curTreeNode.intmenuid?$("[href='"+curTreeNode.strmenuvalue+"'] span").html(menuname):(html=$("[href='"+curTreeNode.strmenuvalue+"']").html(),$("[href='"+curTreeNode.strmenuvalue+"']").html(html.replace(/<\/i>(.*)/,"</i>"+menuname))),$("[href='"+curTreeNode.strmenuvalue+"'] i").attr("class",icon),menus=[],$("[class~='ajax-link'][href!='#']").each(function(e){var menu={};menu.data=$(this).attr("href"),menu.value=$.trim($(this).html().replace(/<i(.*)<\/i>/,"")),menus.push(menu)}),$("#searchMenu").autocomplete().setOptions({lookup:menus}),$.TeachDialog({title:"Operation Message!",content:"Update Menu successfully!"})):$.TeachDialog({title:"Operation Message!",content:"Update Menu failed!"})},async:!0}))})});