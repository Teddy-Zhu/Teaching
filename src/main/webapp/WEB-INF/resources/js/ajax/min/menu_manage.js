function LoadMenuTree(){$.ajax({url:"Menu/MenuTree",dataType:"json",type:"post"}).success(function(e){nodes=$.fn.zTree.init($("#ul_tree"),setting,e),treeObj=$.fn.zTree.getZTreeObj("ul_tree"),treeObj.expandAll(!0),curTreeNode=null})}function treeClick(e,n,r,t){curTreeNode=r,$("#menuname").val(r.strmenuname),$("#menuicon").val(r.strmenuiconclass)}var treeObj,curTreeNode,setting={data:{key:{name:"strmenuname"},simpleData:{enable:!0,idKey:"intmenuid",pIdKey:"intparentmenuid",rootPId:0},view:{showLine:!0,showIcon:!0}},callback:{onClick:treeClick}};$(function(){LoadMenuTree(),$("#refresh").click(function(){LoadMenuTree()}),$("#Update").click(function(){var e,n;return null==curTreeNode?void $.TeachDialog({content:"请至少选择一行!"}):1==curTreeNode.intmenuid?void $.TeachDialog({content:"不能编辑根节点!"}):(e=$("#menuname").val(),n=$("#menuicon").val(),void $.ajax({url:"Menu/Update",type:"post",dataType:"json",data:{menu:curTreeNode.intmenuid,menuname:e,menuicon:n},success:function(r){var t,a;r?(curTreeNode.strmenuname=e,curTreeNode.strmenuiconclass=n,curTreeNode.iconSkin=n+" iconskin",treeObj.updateNode(curTreeNode),1==curTreeNode.intparentmenuid&&2!=curTreeNode.intmenuid?$("[href='"+curTreeNode.strmenuvalue+"'] span").html(e):(t=$("[href='"+curTreeNode.strmenuvalue+"']").html(),$("[href='"+curTreeNode.strmenuvalue+"']").html(t.replace(/<\/i>(.*)/,"</i>"+e))),$("[href='"+curTreeNode.strmenuvalue+"'] i").attr("class",n),a=[],$("[class~='ajax-link'][href!='#']").each(function(e){var n={};n.data=$(this).attr("href"),n.value=$.trim($(this).html().replace(/<i(.*)<\/i>/,"")),a.push(n)}),$("#searchMenu").autocomplete().setOptions({lookup:a}),$.TeachDialog({content:"更新成功!"})):$.TeachDialog({content:"更新失败!"})},async:!0}))})});