function LoadAccessTree(){$.ajax({url:"Power/GetUserTypePower",dataType:"json",type:"post",data:{id:$("#usertype").val()}}).success(function(e){nodes=$.fn.zTree.init($("#ul_tree"),setting,e),treeObj=$.fn.zTree.getZTreeObj("ul_tree");var t=treeObj.getNodeByParam("intparentid",0);t.nocheck=!0,treeObj.updateNode(t),treeObj.expandAll(!0)})}var treeObj,curTreeNode,setting={check:{enable:!0,chkboxType:{Y:"p",N:"ps"}},data:{key:{checked:"intauthvalue",name:"strname",url:""},simpleData:{enable:!0,idKey:"intpowerid",pIdKey:"intparentid",rootPId:0},view:{showLine:!0,showIcon:!0}}};$(function(){$(".panel-body").css("height",.625*$(window).height()+"px"),$.ajax({url:"Type/GetUserTypeAll",dataType:"json",type:"post"}).success(function(e){$("#usertype").empty();for(var t=0;len=e.length,t<len;t++)$("#usertype").append('<option value="'+e[t].intidentityid+'">'+e[t].strname+"</option>");LoadAccessTree()}),$(".usertype").click(function(){LoadAccessTree()}),$("#Update").click(function(){var e,t={},n=new Array,a=treeObj.getChangeCheckedNodes();if(a.length>0){for(e=0;e<a.length;e++)n.push(a[e].intpowerid),t["value"+a[e].intpowerid]=a[e].intauthvalue;t.powerId=n,$.ajax({url:"Power/UpdateUserTypePower",dataType:"json",type:"post",data:t}).success(function(){$.TeachDialog({content:"更新 "+$("#usertype").find("option:selected").text()+" 权限成功!"})})}else $.TeachDialog({content:"无改变!"})}),$("#Reset").click(function(){LoadAccessTree()}),$("#usertype").change(function(){LoadAccessTree()})});