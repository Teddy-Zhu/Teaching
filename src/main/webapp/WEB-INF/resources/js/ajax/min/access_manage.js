function LoadAccessTree(){$.ajax({url:"Power/GetUserTypePower",dataType:"json",type:"post",data:{id:$("#usertype").val()}}).success(function(data){nodes=$.fn.zTree.init($("#ul_tree"),setting,data),treeObj=$.fn.zTree.getZTreeObj("ul_tree");var rootnode=treeObj.getNodeByParam("intparentid",0);rootnode.nocheck=!0,treeObj.updateNode(rootnode),treeObj.expandAll(!0)})}var treeObj,curTreeNode,setting={check:{enable:!0,chkboxType:{Y:"p",N:"ps"}},data:{key:{checked:"intauthvalue",name:"strname",url:""},simpleData:{enable:!0,idKey:"intpowerid",pIdKey:"intparentid",rootPId:0},view:{showLine:!0,showIcon:!0}}};$(function(){$(".panel-body").css("height",.625*$(window).height()+"px"),$.ajax({url:"Type/GetUserTypeAll",dataType:"json",type:"post"}).success(function(data){$("#usertype").empty();for(var i=0;len=data.length,i<len;i++)$("#usertype").append('<option value="'+data[i].intidentityid+'">'+data[i].strname+"</option>");LoadAccessTree()}),$(".usertype").click(function(){LoadAccessTree()}),$("#Update").click(function(){var i,postdata={},powerId=new Array,changes=treeObj.getChangeCheckedNodes();if(changes.length>0){for(i=0;i<changes.length;i++)powerId.push(changes[i].intpowerid),postdata["value"+changes[i].intpowerid]=changes[i].intauthvalue;postdata.powerId=powerId,$.ajax({url:"Power/UpdateUserTypePower",dataType:"json",type:"post",data:postdata}).success(function(){$.TeachDialog({title:"Operation Message!",content:"Update "+$("#usertype").find("option:selected").text()+" access control success!"})})}else $.TeachDialog({title:"Operation Message!",content:"Nothing Changed!"})}),$("#Reset").click(function(){LoadAccessTree()}),$("#usertype").change(function(){LoadAccessTree()})});