function setVal(e,t){$("#editCode"+e).val(t.intcoding),$("#editName"+e).val(t.strname),$("#editAddress"+e).val(t.straddress),$("#editCompanyPhone"+e).val(t.strcompanyphone),$("#editHandlePerson"+e).val(t.strhandlepersonname),$("#editHandlePhone"+e).val(t.strhandlephone),$("#editContactPerson"+e).val(t.strcontactpersonname),$("#editContactPhone"+e).val(t.strcontactpersonphone)}var htmltmp=$("#newformRange").html();$(function(){var e,t=$("#datatable_supplierinfo").attr("data-size");(void 0==t||""==t)&&(t=10),e=($(".box-content.table-responsive").width()-55)/10,$("#datatable_supplierinfo").datagrid({striped:!0,remoteSort:!1,collapsible:!0,fit:!1,url:"Supplier/GetAllSuppliers",loadMsg:"请等待数据载入.....",pagination:!0,rownumbers:!0,fitColumns:!0,pageSize:t,pageList:[t,2*t,3*t,4*t,5*t],columns:[[{field:"intcoding",title:"编号",align:"center",sortable:!0,width:e},{field:"strname",title:"名称",align:"center",width:e,sortable:!0},{field:"straddress",title:"地址",align:"center",width:e,sortable:!0},{field:"strcompanyphone",title:"公司号码",align:"center",width:e,sortable:!0},{field:"strhandlepersonname",title:"负责人",align:"center",width:e,sortable:!0},{field:"strhandlephone",title:"负责人手机",align:"center",width:e,sortable:!0},{field:"strcontactpersonname",title:"联系人",align:"center",width:e,sortable:!0},{field:"strcontactpersonphone",title:"联系人手机",align:"center",width:e,sortable:!0}]]}),$("button.addsupplier").click(function(){$(".newform").val(""),$("#adderrormsg").html(""),$("#operationpanel").slideUp(),$("#addnewsupplier").slideDown()}),$("button.submitAdd").click(function(){var e={},t=!0;$(".newform").each(function(){return""==$(this).val().trim()?($("#adderrormsg").html("请输入 "+$(this).prev().html()+"!"),t=!1,!1):void(e[$(this).attr("id")]=$(this).val().trim())}),t&&$.ajax({url:"Supplier/AddNewSupplier",dataType:"json",type:"post",data:e,success:function(e){$.TeachDialog(e?{content:"添加供应商成功，你需要继续添加吗 ?",showCloseButtonName:"取消",otherButtons:["确认","确认且保存值"],CloseButtonAddFunc:function(){$("#operationpanel").slideToggle(),$("#addnewsupplier").slideToggle(),$("#datatable_supplierinfo").datagrid("reload")},clickButton:function(e,t,n){(0==n||1==n)&&0==n&&$(".newform").val(""),$("#datatable_supplierinfo").datagrid("reload"),t.modal("hide")}}:{content:"添加失败!"})}})}),$("button.cancelAdd").click(function(){$("#addnewsupplier").slideUp(),$("#operationpanel").slideDown()}),$("button.editsupplier").click(function(){var e,t,n=$("#datatable_supplierinfo").datagrid("getSelections");if(0==n.length)return void $.TeachDialog({content:"你至少需要选择一行!",bootstrapModalOption:{}});for($("#supplierEditTable").html(""),$("#editsuppliercontainer .tab-content").html(""),$("#editerrormsg").html(""),e=0;e<n.length;e++)t=n[e].intsupplierid,$("#supplierEditTable").append('<li role="presentation"><a href="#editpanel'+t+'" role="tab" data-toggle="tab">'+n[e].strname+"</a></li>"),$("#editsuppliercontainer .tab-content").append('<div role="tabpanel" class="tab-pane fade" id="editpanel'+t+'"></div>'),$("#editpanel"+t).html(htmltmp.replace("newCode","editCode"+t).replace("newName","editName"+t).replace("newAddress","editAddress"+t).replace("newCompanyPhone","editCompanyPhone"+t).replace("newHandlePerson","editHandlePerson"+t).replace("newHandlePhone","editHandlePhone"+t).replace("newContactPerson","editContactPerson"+t).replace("newContactPhone","editContactPhone"+t).replace(new RegExp("newform","gm"),"editform")),setVal(t,n[e]);$("#supplierEditTable a:first").tab("show"),$("#editsuppliercontainer").slideDown(),$("#operationpanel").slideUp()}),$("button.submitEdit").click(function(){var e,t,n=new Array;if($("[id^=editCode]").each(function(){var e=$(this).attr("id");n.push(e.substring(8,e.length))}),e={},0!=n.length){if(t=!0,$(".editform").each(function(){return""==$(this).val().trim()?($("#editerrormsg").html("请输入 "+$(this).prev().html()+"!"),t=!1,!1):void(e[$(this).attr("id")]=$(this).val().trim())}),!t)return;e.supplierId=n,$.ajax({url:"Supplier/UpdateSuppliers",type:"post",dataType:"json",data:e,success:function(e){$.TeachDialog(e?{content:"编辑供应商成功!",CloseButtonAddFunc:function(){$("#operationpanel").slideDown(),$("#editsuppliercontainer").slideUp(),$("#datatable_supplierinfo").datagrid("reload")}}:{content:"编辑供应商失败!",CloseButtonAddFunc:function(){$("#operationpanel").slideDown(),$("#editsuppliercontainer").slideUp(),$("#datatable_supplierinfo").datagrid("reload")}})}})}}),$("button.cancelEdit").click(function(){$("#operationpanel").slideDown(),$("#editsuppliercontainer").slideUp()}),$("button.removesupplier").click(function(){var e,t,n,a,i=$("#datatable_supplierinfo").datagrid("getSelections");if(0==i.length)return void $.TeachDialog({content:"你至少需要选择一行 !",bootstrapModalOption:{}});for(e=new Array,t=new Array,n=0;n<i.length;n++)e.push(parseInt(i[n].intsupplierid)),t.push(i[n].strname);a=function(){var e=$.Deferred();return $.TeachDialog({content:"你确定删除这些供应商 :"+t+" 吗?",showCloseButtonName:"No",otherButtons:["Yes"],CloseButtonAddFunc:function(){e.reject()},clickButton:function(t,n,a){0==a&&e.resolve(),n.modal("hide")}}),e.promise()},a().done(function(){$.ajax({url:"Supplier/RemoveSupplier",type:"post",dataType:"json",data:{supplierId:e},success:function(e){var t,n;if(e===!0)$.TeachDialog({content:"删除供应商成功!"}),$("#datatable_supplierinfo").datagrid("reload");else if(isNaN(e))$.TeachDialog({content:"删除供应商失败!"});else{for(t="",n=0;n<i.length;n++)if(parseInt(i[n].intsupplierid)==parseInt(e)){t=i[n].strname;break}$.TeachDialog({content:"删除失败! 供应商:"+t+" 被使用中."})}},async:!0})})})});