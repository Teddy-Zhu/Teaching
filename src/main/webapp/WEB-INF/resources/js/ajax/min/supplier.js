function setVal(id,obj){$("#editCode"+id).val(obj.intcoding),$("#editName"+id).val(obj.strname),$("#editAddress"+id).val(obj.straddress),$("#editCompanyPhone"+id).val(obj.strcompanyphone),$("#editHandlePerson"+id).val(obj.strhandlepersonname),$("#editHandlePhone"+id).val(obj.strhandlephone),$("#editContactPerson"+id).val(obj.strcontactpersonname),$("#editContactPhone"+id).val(obj.strcontactpersonphone)}var htmltmp=$("#newformRange").html();$(function(){var cellwidth,psval=$("#datatable_supplierinfo").attr("data-size");(void 0==psval||""==psval)&&(psval=10),cellwidth=($(".box-content.table-responsive").width()-55)/10,$("#datatable_supplierinfo").datagrid({striped:!0,remoteSort:!1,collapsible:!0,fit:!1,url:"Supplier/GetAllSuppliers",loadMsg:"Please waiting for loading date.....",pagination:!0,rownumbers:!0,fitColumns:!0,pageSize:psval,pageList:[psval,2*psval,3*psval,4*psval,5*psval],columns:[[{field:"intcoding",title:"Code",align:"center",sortable:!0,width:cellwidth},{field:"strname",title:"Name",align:"center",width:cellwidth,sortable:!0},{field:"straddress",title:"Address",align:"center",width:cellwidth,sortable:!0},{field:"strcompanyphone",title:"Company Phone",align:"center",width:cellwidth,sortable:!0},{field:"strhandlepersonname",title:"Handle Person",align:"center",width:cellwidth,sortable:!0},{field:"strhandlephone",title:"Handle Phone",align:"center",width:cellwidth,sortable:!0},{field:"strcontactpersonname",title:"Contact Person",align:"center",width:cellwidth,sortable:!0},{field:"strcontactpersonphone",title:"Contact Phone",align:"center",width:cellwidth,sortable:!0}]]}),$("button.addsupplier").click(function(){$(".newform").val(""),$("#adderrormsg").html(""),$("#operationpanel").slideUp(),$("#addnewsupplier").slideDown()}),$("button.submitAdd").click(function(){var postdata={},check=!0;$(".newform").each(function(){return""==$(this).val().trim()?($("#adderrormsg").html("please input "+$(this).prev().html()+"!"),check=!1,!1):void(postdata[$(this).attr("id")]=$(this).val().trim())}),check&&$.ajax({url:"Supplier/AddNewSupplier",dataType:"json",type:"post",data:postdata,success:function(response){$.TeachDialog(response?{title:"Operation Message!",content:"Add a new Supplier successfully and do you want to add more ?",showCloseButtonName:"No",otherButtons:["Yes","Yes & Keep Val"],CloseButtonAddFunc:function(){$("#operationpanel").slideToggle(),$("#addnewsupplier").slideToggle(),$("#datatable_supplierinfo").datagrid("reload")},clickButton:function(sender,modal,index){(0==index||1==index)&&0==index&&$(".newform").val(""),$("#datatable_supplierinfo").datagrid("reload"),modal.modal("hide")}}:{content:"Add Supplier Failed!"})}})}),$("button.cancelAdd").click(function(){$("#addnewsupplier").slideUp(),$("#operationpanel").slideDown()}),$("button.editsupplier").click(function(){var i,id,rows=$("#datatable_supplierinfo").datagrid("getSelections");if(0==rows.length)return void $.TeachDialog({content:"You should select one row at least !",bootstrapModalOption:{}});for($("#supplierEditTable").html(""),$("#editsuppliercontainer .tab-content").html(""),$("#editerrormsg").html(""),i=0;i<rows.length;i++)id=rows[i].intsupplierid,$("#supplierEditTable").append('<li role="presentation"><a href="#editpanel'+id+'" role="tab" data-toggle="tab">'+rows[i].strname+"</a></li>"),$("#editsuppliercontainer .tab-content").append('<div role="tabpanel" class="tab-pane fade" id="editpanel'+id+'"></div>'),$("#editpanel"+id).html(htmltmp.replace("newCode","editCode"+id).replace("newName","editName"+id).replace("newAddress","editAddress"+id).replace("newCompanyPhone","editCompanyPhone"+id).replace("newHandlePerson","editHandlePerson"+id).replace("newHandlePhone","editHandlePhone"+id).replace("newContactPerson","editContactPerson"+id).replace("newContactPhone","editContactPhone"+id).replace(new RegExp("newform","gm"),"editform")),setVal(id,rows[i]);$("#supplierEditTable a:first").tab("show"),$("#editsuppliercontainer").slideDown(),$("#operationpanel").slideUp()}),$("button.submitEdit").click(function(){var postdata,check,idarray=new Array;if($("[id^=editCode]").each(function(){var l=$(this).attr("id");idarray.push(l.substring(8,l.length))}),postdata={},0!=idarray.length){if(check=!0,$(".editform").each(function(){return""==$(this).val().trim()?($("#editerrormsg").html("please input "+$(this).prev().html()+"!"),check=!1,!1):void(postdata[$(this).attr("id")]=$(this).val().trim())}),!check)return;postdata.supplierId=idarray,$.ajax({url:"Supplier/UpdateSuppliers",type:"post",dataType:"json",data:postdata,success:function(data){$.TeachDialog(data?{title:"Operation Message!",content:"Edit Suppliers Info successfully!",CloseButtonAddFunc:function(){$("#operationpanel").slideDown(),$("#editsuppliercontainer").slideUp(),$("#datatable_supplierinfo").datagrid("reload")}}:{title:"Operation Message!",content:"Edit Suppliers Info failed!",CloseButtonAddFunc:function(){$("#operationpanel").slideDown(),$("#editsuppliercontainer").slideUp(),$("#datatable_supplierinfo").datagrid("reload")}})}})}}),$("button.cancelEdit").click(function(){$("#operationpanel").slideDown(),$("#editsuppliercontainer").slideUp()}),$("button.removesupplier").click(function(){var supplierIdArray,namesArray,i,sureDialog,rows=$("#datatable_supplierinfo").datagrid("getSelections");if(0==rows.length)return void $.TeachDialog({content:"You should select one row at least !",bootstrapModalOption:{}});for(supplierIdArray=new Array,namesArray=new Array,i=0;i<rows.length;i++)supplierIdArray.push(parseInt(rows[i].intsupplierid)),namesArray.push(rows[i].strname);sureDialog=function(){var dtd=$.Deferred();return $.TeachDialog({title:"Warnning Message!",content:"Are you sure remove this suppliers :"+namesArray+" ?",showCloseButtonName:"No",otherButtons:["Yes"],CloseButtonAddFunc:function(){dtd.reject()},clickButton:function(sender,modal,index){0==index&&dtd.resolve(),modal.modal("hide")}}),dtd.promise()},sureDialog().done(function(){$.ajax({url:"Supplier/RemoveSupplier",type:"post",dataType:"json",data:{supplierId:supplierIdArray},success:function(response){var suppliername,i;if(response===!0)$.TeachDialog({title:"Operation Message!",content:"Remove suppliers successfully!"}),$("#datatable_supplierinfo").datagrid("reload");else if(isNaN(response))$.TeachDialog({content:"Remove suppliers failed!"});else{for(suppliername="",i=0;i<rows.length;i++)if(parseInt(rows[i].intsupplierid)==parseInt(response)){suppliername=rows[i].strname;break}$.TeachDialog({content:"Remove suppliers failed! Supplier:"+suppliername+" in use."})}},async:!0})})})});