function initUserDepartMent(id,type){if(void 0==type)return dtd.reject();var dtd=$.Deferred();return $.ajax({url:"Type/GetDepartMent",type:"post",dataType:"json",data:{id:type},success:function(data){$("#"+id).empty();for(var i=0;len=data.length,i<len;i++)$("#"+id).append('<option value="'+data[i].intid+'">'+data[i].strname+"</option>");dtd.resolve()},async:!0}),dtd.promise()}function picChange(){var extStart,ext,url,filepath=$("#picfile").val();""!=$.trim(filepath)&&(extStart=filepath.lastIndexOf("."),ext=filepath.substring(extStart,filepath.length).toUpperCase(),".BMP"!=ext&&".PNG"!=ext&&".JPG"!=ext&&".JPEG"!=ext?($("#picfile").val(""),$.TeachDialog({content:"The Picture Format is not correct !"})):(url=window.URL.createObjectURL($("#picfile").prop("files")[0]),$("#UserPic").attr("src",url),$("#UserPic").css("border-color","orange"),$("#picUpload").fadeIn(2e3)))}$(function(){console.log("asd"),initUserDepartMent("DepartMent",1).done(function(){$("#DepartMent").change(function(){initUserDepartMent("Major",$("#DepartMent").val())}),$("#DepartMent").val($("#DepartMent").attr("data-curValue")),initUserDepartMent("Major",$("#DepartMent").val()).done(function(){$("#Major").val($("#Major").attr("data-curValue"))})}),$("#UserPic").hover(function(){$(this).addClass("userpic")},function(){$(this).removeClass("userpic")}),$("#picUpload").on("click",function(){""==$("#UserPic").attr("data-new")&&""!=$("#picfile").val()&&$.ajax("User/UploadUserPic",{files:$("#picfile"),type:"post",iframe:!0,processData:!1,dataType:"text"}).done(function(data){console.log(data),""!=data?($("#UserPic").attr("data-new",data),$.TeachDialog({content:"Upload Avatar Success!"}),$("#UserPic").css("border-color","cadetblue"),$("#picUpload").fadeOut().delay(2e3).fadeOut(),$("#picReset").fadeIn(2e3)):($.TeachDialog({content:"Upload Avatar Failed!"}),$(this).fadeOut().delay(2e3).fadeOut())})}),$("#picReset").click(function(){$("#UserPic").attr("data-new",""),$("#picfile").val(""),$("#UserPic").attr("src",$("#UserPic").attr("data-origin")),$("#UserPic").css("border-color",""),$(this).fadeOut(1e3)}),$("#UserPic").click(function(){$("#picfile").trigger("click")}),$("#savechange").click(function(){var postdata,error,check;return $(".alert.alert-danger").slideUp(),$(".alert.alert-danger").remove(),postdata={},error='<div class="alert alert-danger" role="alert" style="display:none;line-height: 0px;width: 80%;height: 1px;">{errormsg}</div>',check=!0,$(".perinfo").each(function(){var curId=$(this).attr("id"),curval=$(this).val();if(null==curval||void 0==curval)return $(this).parent().next().html(error.replace(/{errormsg}/g,"The Parameter Error!Please don't touch the widget")),check=!1,!0;switch(postdata[curId]=curval.trim(),curId){case"Password":break;case"RePassword":postdata[curId]!=postdata.Password&&($(this).parent().next().html(error.replace(/{errormsg}/g,"New Pasword Should be no differences!")),check=!1);break;default:""==postdata[curId]&&($(this).parent().next().html(error.replace(/{errormsg}/g,"The "+$(this).prev().html().trimEnd(":")+" can not be empty!")),check=!1)}}),check?(postdata.picfile=$("#UserPic").attr("data-new"),void $.ajax({url:"User/UpdateUser",data:postdata,type:"post",dataType:"json",success:function(response){response?($.TeachDialog({title:"Operation Message!",content:"Update Successfully!"}),LoadAjaxContent("ajax/personinfo_manage")):$.TeachDialog({title:"Operation Message!",content:"Update Failed"})}})):void $(".alert.alert-danger").slideDown()}),$("#reset").click(function(){LoadAjaxContent("ajax/personinfo_manage")})});