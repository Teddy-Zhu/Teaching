function initUserDepartMent(e,t){if(void 0==t)return a.reject();var a=$.Deferred();return $.ajax({url:"Type/GetDepartMent",type:"post",dataType:"json",data:{id:t},success:function(t){$("#"+e).empty();for(var r=0;len=t.length,r<len;r++)$("#"+e).append('<option value="'+t[r].intid+'">'+t[r].strname+"</option>");a.resolve()},async:!0}),a.promise()}function picChange(){var e,t,a,r=$("#picfile").val();""!=$.trim(r)&&(e=r.lastIndexOf("."),t=r.substring(e,r.length).toUpperCase(),".BMP"!=t&&".PNG"!=t&&".JPG"!=t&&".JPEG"!=t?($("#picfile").val(""),$.TeachDialog({content:"图片格式不正确 !"})):(a=window.URL.createObjectURL($("#picfile").prop("files")[0]),$("#UserPic").attr("src",a),$("#UserPic").css("border-color","orange"),$("#picUpload").fadeIn(2e3)))}$(function(){console.log("asd"),initUserDepartMent("DepartMent",1).done(function(){$("#DepartMent").change(function(){initUserDepartMent("Major",$("#DepartMent").val())}),$("#DepartMent").val($("#DepartMent").attr("data-curValue")),initUserDepartMent("Major",$("#DepartMent").val()).done(function(){$("#Major").val($("#Major").attr("data-curValue"))})}),$("#UserPic").hover(function(){$(this).addClass("userpic")},function(){$(this).removeClass("userpic")}),$("#picUpload").on("click",function(){""==$("#UserPic").attr("data-new")&&""!=$("#picfile").val()&&$.ajax("User/UploadUserPic",{files:$("#picfile"),type:"post",iframe:!0,processData:!1,dataType:"text"}).done(function(e){console.log(e),""!=e?($("#UserPic").attr("data-new",e),$.TeachDialog({content:"上传成功!"}),$("#UserPic").css("border-color","cadetblue"),$("#picUpload").fadeOut().delay(2e3).fadeOut(),$("#picReset").fadeIn(2e3)):($.TeachDialog({content:"上传失败!"}),$(this).fadeOut().delay(2e3).fadeOut())})}),$("#picReset").click(function(){$("#UserPic").attr("data-new",""),$("#picfile").val(""),$("#UserPic").attr("src",$("#UserPic").attr("data-origin")),$("#UserPic").css("border-color",""),$(this).fadeOut(1e3)}),$("#UserPic").click(function(){$("#picfile").trigger("click")}),$("#savechange").click(function(){var e,t,a;return $(".alert.alert-danger").slideUp(),$(".alert.alert-danger").remove(),e={},t='<div class="alert alert-danger" role="alert" style="display:none;line-height: 0px;width: 80%;height: 1px;">{errormsg}</div>',a=!0,$(".perinfo").each(function(){var r=$(this).attr("id"),n=$(this).val();if(null==n||void 0==n)return $(this).parent().next().html(t.replace(/{errormsg}/g,"变量错误 !")),a=!1,!0;switch(e[r]=n.trim(),r){case"Password":break;case"RePassword":e[r]!=e.Password&&($(this).parent().next().html(t.replace(/{errormsg}/g,"新密码与其重复值不同!")),a=!1);break;default:""==e[r]&&($(this).parent().next().html(t.replace(/{errormsg}/g,"表单 "+$(this).prev().html().trimEnd(":")+" 不能为空!")),a=!1)}}),a?(e.picfile=$("#UserPic").attr("data-new"),void $.ajax({url:"User/UpdateUser",data:e,type:"post",dataType:"json",success:function(e){e?($.TeachDialog({content:"更新成功!"}),LoadAjaxContent("ajax/personinfo_manage")):$.TeachDialog({content:"更新失败"})}})):void $(".alert.alert-danger").slideDown()}),$("#reset").click(function(){LoadAjaxContent("ajax/personinfo_manage")})});