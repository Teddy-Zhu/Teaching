function getSearchParams(t){var e=new Object;return void 0!=t&&(e=t),$(".SearchForm").each(function(){var t=$(this).val().trim();void 0==t&&(t=""),e[$(this).attr("id")]=t}),e}function initBookType(t,e){$.ajax({url:"Type/GetBookType",dataType:"json",type:"post",success:function(o){$("#"+t).empty(),void 0!=e&&$("#"+t).append('<option value="-1">全部</option>');for(var i=0;len=o.length,i<len;i++)$("#"+t).append('<option value="'+o[i].intbooktypeid+'">'+o[i].strbooktypename+"</option>")},async:!0})}function initSupplierType(t,e){$.ajax({url:"Type/GetSupplierType",dataType:"json",type:"post",success:function(o){$("#"+t).empty(),void 0!=e&&$("#"+t).append('<option value="-1">全部</option>');for(var i=0;len=o.length,i<len;i++)$("#"+t).append('<option value="'+o[i].intsupplierid+'">'+o[i].strname+"</option>")}})}$(function(){$.ajax({url:"Plan/GetCourseType",dataType:"json",type:"post"}).success(function(t){for(var e=0;len=t.length,e<len;e++)$("#CourseType").append('<option value="'+t[e].intcoursetypeid+'">'+t[e].strcoursename+"</option>")}),$("#bookselect").click(function(){LoadModel("selectbookmodel").done(function(t){$.TeachDialog({modalID:"SelectBooksModal",title:"从表中选择书籍",content:t,largeSize:!0,otherButtons:["选择"],otherButtonStyles:["btn btn-primary"],clickButton:function(t,e,o){if(0==o){var i=$("#datatable_bookinfo").datagrid("getSelections");if(1!=i.length)return void $.TeachDialog({content:"你至少选择一行!",bootstrapModalOption:{}});$("#BookId").empty(),$("#BookId").append('<option value="'+i[0].intbookid+'">'+i[0].strbookname+"</option>"),e.modal("hide")}},dialogHide:function(){},dialogShown:function(){$("#SearchDate").datepicker({format:"yyyy-mm-dd",todayBtn:"linked",autoclose:!0,todayHighlight:!0,clearBtn:!0}),initBookType("SearchType","type"),initSupplierType("SearchSupplier","type"),cellwidth=($(".modal-body").width()-55)/11;var t=$("#datatable_bookinfo");t.datagrid({striped:!0,remoteSort:!1,collapsible:!0,singleSelect:!0,fit:!1,url:"Book/GetBooks",loadMsg:"请等待数据载入.....",pagination:!0,rownumbers:!0,fitColumns:!0,columns:[[{field:"strbookcoding",title:"编号",align:"center",sortable:!0,width:cellwidth},{field:"strbookname",title:"书名",align:"center",width:cellwidth,sortable:!0},{field:"strbooksn",title:"SN号",align:"center",width:cellwidth,sortable:!0},{field:"bookType",title:"类型",align:"center",width:cellwidth,sortable:!0,formatter:function(t){return t.strbooktypename}},{field:"strpress",title:"出版社",align:"center",width:cellwidth,sortable:!0},{field:"strauthor",title:"作者",align:"center",width:cellwidth,sortable:!0},{field:"supplier",title:"供应商",align:"center",width:cellwidth,sortable:!0,formatter:function(t){return t.strname}},{field:"strprice",title:"单价",align:"center",width:cellwidth,sortable:!0},{field:"intpricediscount",title:"折扣",align:"center",width:cellwidth,sortable:!0},{field:"dateaddtime",title:"录入时间",align:"center",width:cellwidth+35,sortable:!0,formatter:function(t){return unix2human(t)}}]],onBeforeLoad:function(t){t=getSearchParams(t)},onDblClickRow:function(t,e){$("#BookId").empty(),$("#BookId").append('<option value="'+e.intbookid+'">'+e.strbookname+"</option>"),$("#SelectBooksModal").modal("hide")}}),$("#Search").click(function(){t.datagrid("reload")})}})})}),$("#reset").click(function(){LoadAjaxContent("ajax/plan_submit")}),$("#submitform").click(function(){var t,e,o;return $(this).button("loading"),$(".alert.alert-danger").slideUp(),$(".alert.alert-danger").remove(),t={},e='<div class="alert alert-danger" role="alert" style="display:none;line-height: 0px;width: 80%;height: 1px;">{errormsg}</div>',o=!0,$(".planinfo").each(function(){var i=$(this).attr("id"),n=$(this).val();return n&&""!==n.trim()?void(t[i]=n.trim()):(void 0===$(this).prev().html()?$(this).parent().parent().next().html(e.replace(/{errormsg}/g,"表单 "+$(this).parent().prev().html().trimEnd(":")+" 不能为空!")):$(this).parent().next().html(e.replace(/{errormsg}/g,"表单 "+$(this).prev().html().trimEnd(":")+" 不能为空！")),o=!1,!1)}),o?($.ajax({url:"Plan/Submit",dataType:"json",type:"post",async:!0,data:t}).success(function(t){t?($.TeachDialog({content:"更新成功!"}),LoadAjaxContent("ajax/plan_submit")):$.TeachDialog({content:"更新失败!"})}),void $(this).button("reset")):($(".alert.alert-danger").slideDown(),void $(this).button("reset"))})});