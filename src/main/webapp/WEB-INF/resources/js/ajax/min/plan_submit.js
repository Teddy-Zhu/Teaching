function getSearchParams(params){var searchParams=new Object;return void 0!=params&&(searchParams=params),$(".SearchForm").each(function(){var param=$(this).val().trim();void 0==param&&(param=""),searchParams[$(this).attr("id")]=param}),searchParams}function initBookType(id,addition){$.ajax({url:"Type/GetBookType",dataType:"json",type:"post",success:function(data){$("#"+id).empty(),void 0!=addition&&$("#"+id).append('<option value="-1">All Type</option>');for(var i=0;len=data.length,i<len;i++)$("#"+id).append('<option value="'+data[i].intbooktypeid+'">'+data[i].strbooktypename+"</option>")},async:!0})}function initSupplierType(id,addition){$.ajax({url:"Type/GetSupplierType",dataType:"json",type:"post",success:function(data){$("#"+id).empty(),void 0!=addition&&$("#"+id).append('<option value="-1">All Supplier</option>');for(var i=0;len=data.length,i<len;i++)$("#"+id).append('<option value="'+data[i].intsupplierid+'">'+data[i].strname+"</option>")}})}$(function(){$.ajax({url:"Plan/GetCourseType",dataType:"json",type:"post"}).success(function(data){for(var i=0;len=data.length,i<len;i++)$("#CourseType").append('<option value="'+data[i].intcoursetypeid+'">'+data[i].strcoursename+"</option>")}),$("#bookselect").click(function(){LoadModel("selectbookmodel").done(function(responseConent){$.TeachDialog({modalID:"SelectBooksModal",title:"Select Books From Table",content:responseConent,largeSize:!0,otherButtons:["Select"],otherButtonStyles:["btn btn-primary"],clickButton:function(sender,modal,index){if(0==index){var rows=$("#datatable_bookinfo").datagrid("getSelections");if(1!=rows.length)return void $.TeachDialog({content:"You should select a row!",bootstrapModalOption:{}});$("#BookId").empty(),$("#BookId").append('<option value="'+rows[0].intbookid+'">'+rows[0].strbookname+"</option>"),modal.modal("hide")}},dialogHide:function(){},dialogShown:function(){$("#SearchDate").datepicker({format:"yyyy-mm-dd",todayBtn:"linked",autoclose:!0,todayHighlight:!0,clearBtn:!0}),initBookType("SearchType","type"),initSupplierType("SearchSupplier","type"),cellwidth=($(".modal-body").width()-55)/11;var $mydategrid=$("#datatable_bookinfo");$mydategrid.datagrid({striped:!0,remoteSort:!1,collapsible:!0,singleSelect:!0,fit:!1,url:"Book/GetBooks",loadMsg:"Please waiting for loading date.....",pagination:!0,rownumbers:!0,fitColumns:!0,columns:[[{field:"strbookcoding",title:"Code",align:"center",sortable:!0,width:cellwidth},{field:"strbookname",title:"Name",align:"center",width:cellwidth,sortable:!0},{field:"strbooksn",title:"SN",align:"center",width:cellwidth,sortable:!0},{field:"bookType",title:"Type",align:"center",width:cellwidth,sortable:!0,formatter:function(value){return value.strbooktypename}},{field:"strpress",title:"Press",align:"center",width:cellwidth,sortable:!0},{field:"strauthor",title:"Author",align:"center",width:cellwidth,sortable:!0},{field:"supplier",title:"Supplier",align:"center",width:cellwidth,sortable:!0,formatter:function(value){return value.strname}},{field:"strprice",title:"Price",align:"center",width:cellwidth,sortable:!0},{field:"intpricediscount",title:"DisCount",align:"center",width:cellwidth,sortable:!0},{field:"dateaddtime",title:"Add Time",align:"center",width:cellwidth+35,sortable:!0,formatter:function(value){return unix2human(value)}}]],onBeforeLoad:function(param){param=getSearchParams(param)},onDblClickRow:function(rowIndex,rowData){$("#BookId").empty(),$("#BookId").append('<option value="'+rowData.intbookid+'">'+rowData.strbookname+"</option>"),$("#SelectBooksModal").modal("hide")}}),$("#Search").click(function(){$mydategrid.datagrid("reload")})}})})}),$("#reset").click(function(){LoadAjaxContent("ajax/plan_submit")}),$("#submitform").click(function(){var postdata,error,check;return $(this).button("loading"),$(".alert.alert-danger").slideUp(),$(".alert.alert-danger").remove(),postdata={},error='<div class="alert alert-danger" role="alert" style="display:none;line-height: 0px;width: 80%;height: 1px;">{errormsg}</div>',check=!0,$(".planinfo").each(function(){var curId=$(this).attr("id"),curval=$(this).val();return curval&&""!==curval.trim()?void(postdata[curId]=curval.trim()):(void 0===$(this).prev().html()?$(this).parent().parent().next().html(error.replace(/{errormsg}/g,"The "+$(this).parent().prev().html().trimEnd(":")+" can not be empty!")):$(this).parent().next().html(error.replace(/{errormsg}/g,"The "+$(this).prev().html().trimEnd(":")+" can not be empty!")),check=!1,!1)}),check?($.ajax({url:"Plan/Submit",dataType:"json",type:"post",async:!0,data:postdata}).success(function(response){response?($.TeachDialog({title:"Operation Message!",content:"Update Successfully!"}),LoadAjaxContent("ajax/plan_submit")):$.TeachDialog({title:"Operation Message!",content:"Update failed!"})}),void $(this).button("reset")):($(".alert.alert-danger").slideDown(),void $(this).button("reset"))})});